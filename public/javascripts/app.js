/*! airconditioner-remote 2016-08-28 */
!function(){"use strict";function a(a){function c(a){var c=$(".timer-on"),d=$(".timer-off");a&&(f.timerOn=a.timerOn?new Date(a.timerOn):null,f.timerOff=a.timerOff?new Date(a.timerOff):null),c.find(".info").toggleClass("hidden",!f.timerOn),c.find(".label").html("Timer set for "+b(f.timerOn)),d.find(".info").toggleClass("hidden",!f.timerOff),d.find(".label").html("Timer set for "+b(f.timerOff))}$("#power").toggleClass("active",a.on).attr("data-command","power-"+(a.on?"off":"on")),$(".temperature .digital").spinner("update",a.temp),$(".mode-"+a.mode).button("toggle"),$(".fan-"+a.fan).button("toggle"),c(a),(a.timerOn||a.timerOff)&&null===e&&(e=setInterval(function(){var a=Date.now();f.timerOn&&a>=f.timerOn.getTime()&&(f.timerOn=null),f.timerOff&&a>=f.timerOff.getTime()&&(f.timerOff=null),null===f.timerOn&&null===f.timerOff&&clearInterval(e),c()},3e4))}function b(a){if(a){var b=new Date,c=Math.round((a.getTime()-b.getTime())/1e3/60);return 0>=c?"less than 1 minute from now":c+" minute"+(1===c?"":"s")+" from now"}}function c(){var a=$(".alert");a.removeClass("alert-hidden"),setTimeout(function(){a.addClass("alert-hidden")},2e3)}function d(b,d){$.post(b,d).done(a).done(c)}var e=null,f={timerOn:null,timerOff:null};$.getJSON("remote").done(function(b){$(function(){a(b)})}),$(function(){$.fastButton("button",function(){return $(this).trigger("click"),!1}),$(".temperature .digital").on("spin",$.debounce(300,function(a,b){d("remote/temp-"+b)})).spinner({up:".temperature .up",down:".temperature .down",start:25,min:18,max:32});var a={start:0,min:0,max:60,step:5,format:function(a){return 10>a?"0"+a:a}};$(".timer-on .digital").spinner($.extend(a,{up:".timer-on .up",down:".timer-on .down"})),$(".timer-off .digital").spinner($.extend(a,{up:".timer-off .up",down:".timer-off .down"})),$(".timer-set").on("click",function(){var a=$(this).closest(".timer"),b=/timer-(on|off)/.exec(a.get(0).className)[1];d("remote/timer/"+b,{time:a.find(".digital").html()})}),$(".timer-clear").on("click",function(){var a=$(this).closest(".timer"),b=/timer-(on|off)/.exec(a.get(0).className)[1];d("remote/timer/"+b+"/clear")}),$("[data-command]").on("click",function(){d("remote/"+$(this).attr("data-command"))})})}();