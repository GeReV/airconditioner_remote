/*! airconditioner-remote 2016-08-29 */
!function(){"use strict";function a(a){function c(a){var c=$(".timer-on"),d=$(".timer-off");a&&(g.timerOn=a.timerOn?new Date(a.timerOn):null,g.timerOff=a.timerOff?new Date(a.timerOff):null),c.find(".info").toggleClass("hidden",!g.timerOn),c.find(".label").html("Timer set for "+b(g.timerOn)),d.find(".info").toggleClass("hidden",!g.timerOff),d.find(".label").html("Timer set for "+b(g.timerOff))}$("#power").toggleClass("active",a.power).attr("data-command","power-"+(a.power?"off":"on")),$(".temperature .digital").spinner("update",a.temp),$(".mode-"+a.mode).button("toggle"),$(".fan-"+a.fan).button("toggle"),c(a),(a.timerOn||a.timerOff)&&null===f&&(f=setInterval(function(){var a=Date.now();g.timerOn&&a>=g.timerOn.getTime()&&(g.timerOn=null),g.timerOff&&a>=g.timerOff.getTime()&&(g.timerOff=null),null===g.timerOn&&null===g.timerOff&&clearInterval(f),c()},3e4))}function b(a){if(a){var b=new Date,c=Math.round((a.getTime()-b.getTime())/1e3/60);return c<=0?"less than 1 minute from now":c+" minute"+(1===c?"":"s")+" from now"}}function c(a,b){var c=$(".alert");e&&(clearTimeout(e),e=null),c.removeClass("alert-success alert-danger"),"error"===b?c.addClass("alert-danger").text("An error occurred."):c.addClass("alert-success").text("Command sent."),setTimeout(function(){c.removeClass("alert-hidden")},16),e=setTimeout(function(){c.addClass("alert-hidden")},2e3)}function d(b,d){$.post(b,d).done(a).complete(c)}var e,f=null,g={timerOn:null,timerOff:null};$.getJSON("remote").done(function(b){$(function(){a(b)})}),$(function(){$.fastButton("button",function(){return $(this).trigger("click"),!1}),$(".temperature .digital").on("spin",$.debounce(300,function(a,b){d("remote/temp-"+b)})).spinner({up:".temperature .up",down:".temperature .down",start:25,min:18,max:32});var a={start:0,min:0,max:60,step:5,format:function(a){return a<10?"0"+a:a}};$(".timer-on .digital").spinner($.extend(a,{up:".timer-on .up",down:".timer-on .down"})),$(".timer-off .digital").spinner($.extend(a,{up:".timer-off .up",down:".timer-off .down"})),$(".timer-set").on("click",function(){var a=$(this).closest(".timer"),b=/timer-(on|off)/.exec(a.get(0).className)[1];d("remote/timer/"+b,{time:a.find(".digital").html()})}),$(".timer-clear").on("click",function(){var a=$(this).closest(".timer"),b=/timer-(on|off)/.exec(a.get(0).className)[1];d("remote/timer/"+b+"/clear")}),$("[data-command]").on("click",function(){d("remote/"+$(this).attr("data-command"))})})}();